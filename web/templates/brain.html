{% extends "base.html" %}

{% block title %}The Brain - Venom{% endblock %}

{% block nav_brain_active %}active{% endblock %}

{% block body_attrs %}data-layout="brain"{% endblock %}

{% block content %}
<div class="venom-page">
    <header class="venom-page-header">
        <div class="venom-page-header__content">
            <p class="venom-eyebrow">Knowledge Graph</p>
            <h1>ğŸ§  The Brain</h1>
            <p class="venom-page-description">
                Interaktywny graf pamiÄ™ci i komponentÃ³w Venoma â€“ filtrowanie, eksport i wglÄ…d w zaleÅ¼noÅ›ci.
            </p>
        </div>
        <div class="venom-page-header__meta">
            <div class="venom-meta-card">
                <span class="venom-meta-label">WÄ™zÅ‚y grafu</span>
                <span class="venom-meta-value" id="brainNodesMeta">0</span>
            </div>
            <div class="venom-meta-card">
                <span class="venom-meta-label">KrawÄ™dzie</span>
                <span class="venom-meta-value" id="brainEdgesMeta">0</span>
            </div>
            <div class="venom-meta-card">
                <span class="venom-meta-label">Status</span>
                <span class="venom-meta-value" id="brainStatus">Åadowanie...</span>
            </div>
            <div class="venom-meta-card">
                <span class="venom-meta-label">Ostatnie odÅ›wieÅ¼enie</span>
                <span class="venom-meta-value" id="brainLastUpdated">-</span>
            </div>
            <div class="venom-page-actions">
                <label class="venom-toggle">
                    <input type="checkbox" id="brainAutoRefreshToggle" checked />
                    <span>Auto odÅ›wieÅ¼anie</span>
                </label>
                <button type="button" class="venom-ghost-btn" id="brainRefreshBtn">ğŸ”„ OdÅ›wieÅ¼</button>
            </div>
        </div>
    </header>

    <section class="brain-insights" aria-label="Podsumowanie grafu">
        <article class="brain-insight-card">
            <p class="brain-insight-label">Widoczne wÄ™zÅ‚y</p>
            <div class="brain-insight-value" id="brainVisibleNodes">0</div>
            <p class="brain-insight-subtitle">z <span id="brainTotalNodes">0</span> ogÃ³Å‚em</p>
        </article>
        <article class="brain-insight-card">
            <p class="brain-insight-label">Widoczne krawÄ™dzie</p>
            <div class="brain-insight-value" id="brainVisibleEdges">0</div>
            <p class="brain-insight-subtitle">z <span id="brainTotalEdges">0</span> ogÃ³Å‚em</p>
        </article>
        <article class="brain-insight-card brain-insight-card--wide">
            <p class="brain-insight-label">Filtry</p>
            <div class="brain-insight-value brain-insight-value--small" id="brainFilterSummary">
                Wszystkie typy aktywne
            </div>
            <p class="brain-insight-subtitle" id="brainFilterDetails">WyÅ‚Ä…czone: brak</p>
        </article>
    </section>

<div class="brain-shell">
    <div
        id="cy"
        class="brain-graph"
        role="application"
        aria-label="Graf wiedzy - interaktywna wizualizacja relacji miÄ™dzy elementami systemu"
        tabindex="0"
    ></div>

    <div class="brain-controls">
        <div class="brain-panel-header">
            <div class="brain-panel-title">
                <h3>
                    <span>ğŸ§ </span>
                    <span>The Brain</span>
                </h3>
            </div>
        </div>

        <div class="brain-stats">
            <div class="brain-stat-row">
                <span class="brain-stat-label">WÄ™zÅ‚y:</span>
                <span class="brain-stat-value" id="brainStatNodes">0</span>
            </div>
            <div class="brain-stat-row">
                <span class="brain-stat-label">KrawÄ™dzie:</span>
                <span class="brain-stat-value" id="brainStatEdges">0</span>
            </div>
        </div>

        <div class="brain-search">
            <input
                type="text"
                id="brainSearchInput"
                placeholder="Szukaj w grafie (nazwa wÄ™zÅ‚a...)"
                aria-label="Szukaj wÄ™zÅ‚Ã³w w grafie"
            />
        </div>

        <div class="brain-actions">
            <div class="brain-actions-group">
                <button type="button" id="brainExportJson" class="brain-action-btn" disabled>
                    ğŸ’¾ JSON
                </button>
                <button type="button" id="brainExportPng" class="brain-action-btn" disabled>
                    â¬‡ï¸ PNG
                </button>
            </div>
        </div>

        <div class="brain-filters" role="group" aria-label="Filtruj typy wÄ™zÅ‚Ã³w">
            <label class="brain-filter-toggle" for="brain-filter-agents">
                <input type="checkbox" id="brain-filter-agents" data-filter="agents" checked />
                <span>ğŸ”· Agenci</span>
            </label>
            <label class="brain-filter-toggle" for="brain-filter-files">
                <input type="checkbox" id="brain-filter-files" data-filter="files" checked />
                <span>ğŸ“„ Pliki</span>
            </label>
            <label class="brain-filter-toggle" for="brain-filter-memories">
                <input type="checkbox" id="brain-filter-memories" data-filter="memories" checked />
                <span>ğŸ’¡ Lekcje</span>
            </label>
            <label class="brain-filter-toggle" for="brain-filter-functions">
                <input type="checkbox" id="brain-filter-functions" data-filter="functions" checked />
                <span>âš™ï¸ Funkcje</span>
            </label>
            <label class="brain-filter-toggle" for="brain-filter-classes">
                <input type="checkbox" id="brain-filter-classes" data-filter="classes" checked />
                <span>ğŸ”¶ Klasy</span>
            </label>
        </div>

        <div id="brainAlert" class="brain-alert" role="alert" aria-live="assertive"></div>
    </div>

    <div id="nodeDetails" class="brain-node-details" aria-live="polite">
        <button class="brain-close-btn" type="button" id="closeNodeDetails" aria-label="Zamknij panel szczegÃ³Å‚Ã³w">Ã—</button>
        <h3 id="nodeDetailsTitle">
            <span id="nodeDetailsIcon"></span>
            <span id="nodeDetailsLabel"></span>
        </h3>
        <div id="nodeDetailsContent"></div>
    </div>

    <div id="loadingOverlay" class="brain-loading">
        <div class="brain-spinner"></div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Cytoscape.js CDN with integrity check -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"
        integrity="sha512-gt0OGsN5GWmK4eZTdepGEyDGRaXXALaxw7svEQ+bVXwPJ2JJXmBmF0DaYqRvDVXOvTiXUflQcTznRdLGiCJnXw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
<!-- Brain Logic -->
<script src="/static/js/brain.js"></script>
{% endblock %}
